(function(b){var a={};a.Spotter=function(f,d,n){a.Spotter.instanceCount=(a.Spotter.instanceCount===undefined)?1:a.Spotter.instanceCount+1;var h="_so"+a.Spotter.instanceCount;var m=false;var o=true;var s=null;var t=[];var l=null;var c;var q=[];var k;var v;var i;if(n&&n.buffer===true){k=true;i=(n.bufferTimeout&&n.bufferTimeout>0)?n.bufferTimeout:1000}b.spotterjs[h]=this;if(!a.modules[f.split(".")[0]]||!a.modules[f.split(".")[0]][f.split(".")[1]]){throw new Error("Spotter: Module "+f+" not found! (Did you remember to include it via a script tag?)")}try{c=new (b.spotterjs.modules[f.split(".")[0]][f.split(".")[1]])(d)}catch(r){throw new Error("problem creating "+f+" module -- "+r)}if(!c.url||!c.process){throw new Error("Spotter: spotterjs.modules."+f+" is invalid.  (Does it return an object with url and process methods?)")}var g=function(w){var x=document.getElementsByTagName("head");var e=document.createElement("script");e.id=h+"_request";e.type="text/javascript";e.src=w;if(s){x[0].removeChild(s)}x[0].appendChild(e);s=e};var u=function(w){for(var e in t){if(typeof t[e]==="object"){t[e].notify(w)}else{if(typeof t[e]==="function"){t[e](w)}else{throw new Error("observer list contains an invalid object")}}}};var p=function(){if(q.length>0){v=setTimeout(function(){u(q.pop());p()},i)}else{clearTimeout(v);v=false}};var j=function(){var e;var w=this;if(o){e=c.url();if(e instanceof Object&&e.callbackParam!==undefined){e=e.url+"&"+e.callbackParam+"=spotterjs."+h+".callback"}else{e+="&callback=spotterjs."+h+".callback"}e+="&random="+Math.floor(Math.random()*10000);g(e)}};this.start=function(){if(!m){m=true;j()}else{throw new Error("Spotter: You can't start a spotter that is already running!")}};this.callback=function(x){var e=c.process(x);var w;if(e.update){if(!k){u(e.data)}else{for(w=0;w<e.data.length;w++){q.push(e.data[w])}if(!v){p()}}}o=true;if(c.nextTimeout()>0){l=setTimeout(j,c.nextTimeout()*1000)}else{this.stop()}};this.stop=function(){if(!m){throw new Error("Spotter: You can't stop a stopped spotter!")}else{m=false;var e=document.getElementsByTagName("head");if(s){e[0].removeChild(s)}clearTimeout(l)}};this.register=function(e){if(e!==undefined&&e.notify!==undefined&&typeof e.notify==="function"){t.push(e)}else{if(e!==undefined&&typeof e==="function"){t.push(e)}else{throw new TypeError("Observer must implement a notify method.")}}}};a.util={};a.util.changes=function(e,d){var c=[];var g={};var f;for(f=0;f<d.length;f++){if(!g[d[f]]){g[d[f].name]=parseInt(f,10)}}for(f=0;f<e.length;f++){c[f]=g[e[f].name]===undefined?-1:g[e[f].name]}return c};a.util.complements=function(d,c){var h={};var l=[];var m=[];var g,f,e;for(g=0;g<d.length;g++){if(h[d[g]]===undefined){h[d[g].name]=g}}for(f=0;f<f.length;f++){if(h[c[f].name]===null){m.push(c[f])}else{h[c[f].name]=-1}}for(e in h){if(h[e]>=0){l.push(d[h[e]])}}return[l,m]};a.modules={};a.modules.Module=function(c,e){var g;var f=["period"];if(c.period!==undefined&&typeof(c.period)==="number"){g=c.period;delete c.period}else{g=45}this.nextTimeout=function(i){if(i!==undefined){g=i}else{return g}};var d=function(j,l){var k;for(k=0;k<j.length;k++){if(j[k]===l){return true}}return false};var h=function(k){var j;for(j=0;j<k.require.length;j++){if(c[k.require[j]]===undefined||c[k.require[j]]===""){throw new Error("this module requires nonempty option "+k.require[j])}}for(j in c){if(!d(k.allow,j)&&!d(f,j)&&!d(k.require,j)){throw new Error("option '"+j+"' not allowed")}}};this.baseURL=function(i){if(i&&typeof i==="string"){base=i}else{return base}};if(e){h(e)}};a.verify=function(c){var d;for(d=0;d<c.length;d++){if(!a[c[d]]||(typeof a[c[d]]!=="object"&&typeof a[c[d]]!=="function")){throw new Error(c[d]+" not loaded.  Make sure you load spotter.js before loading any modules.")}}};a.namespace=function(c){if(!a.modules[c]){a.modules[c]={};return a.modules[c]}else{if(typeof a.modules[c]!=="object"){throw new Error("spotterjs.modules."+c+" is not an object!")}}};b.spotterjs=a;b.Spotter=a.Spotter})(window);(function(d,b){var a=d.spotterjs;if(!a||!a.verify){throw new Error("problem with spotter.js file!")}a.verify(["util","modules"]);var c=a.namespace(b);c.recent=function(e){a.modules.Module.call(this,e);var g=function(j,k){for(var h=0;h<k.length;++h){if(k[h].u===j.u){return h}}return k.length};var f;this.url=function(){var h="http://feeds.delicious.com/v2/json/recent?count=100";return h};this.process=function(k){var h={};var l;if(f===undefined){f=k[0];h={data:k,update:true}}else{if(f.u===k[0].u){h={data:k,update:false}}else{l=k.length-g(f,k);for(var j=0;j<l;j++){k.pop()}h={data:k,update:true};f=k[0]}}return h}};c.tags=function(f){a.modules.Module.call(this,f);var e=f.tags;if(e===undefined||e===""){throw new Error("delicious tags module requires tags to be specified as an option")}var g;var h=function(k,l){for(var j=0;j<l.length;++j){if(l[j].u===k.u){return j}}return l.length};this.url=function(){var i="http://feeds.delicious.com/v2/json/tag/"+e+"?count=100";return i};this.process=function(l){var j={};var m;if(g===undefined){g=l[0];j={data:l,update:true}}else{if(g.u===l[0].u){j={data:l,update:false}}else{m=l.length-h(g,l);for(var k=0;k<m;k++){l.pop()}j={data:l,update:true};g=l[0]}}return j}}})(window,"delicious");(function(d,b){var a=d.spotterjs;if(!a){throw new Error("spotter not yet loaded!")}if(!a||!a.verify){throw new Error("problem with spotter.js file!")}a.verify(["util","modules"]);var c=a.namespace(b);c.search=function(g){a.modules.Module.call(this,g);var f=g.q;var e=null;var h;if(f===undefined||f===""){throw new Error("facebook search module requires a search string (q) to be specified as an option")}this.url=function(){var i="http://graph.facebook.com/search";i+="?q="+escape(f);return i};this.process=function(j){var i={};i.data=[];for(h in j.data){if((e===null||j.data[h].created_time>e)&&j.data[h].message!==undefined){j.data[h].profile_image_url="http://graph.facebook.com/"+j.data[h].from.id+"/picture";j.data[h].profile_url="http://www.facebook.com/people/"+j.data[h].from.name.replace(" ","-")+"/"+j.data[h].from.id;i.data.push(j.data[h])}}e=j.data[0].created_time;i.update=(i.data.length>0)?true:false;return i}}})(window,"facebook");(function(d,b){var a=d.spotterjs;if(!a||!a.verify){throw new Error("problem with spotter.js file!")}a.verify(["util","modules"]);var c=a.namespace(b);c.search=function(g){a.modules.Module.call(this,g);if(g===undefined||g.api_key===undefined||(g.q===undefined&&g.tags===undefined)){throw new Error("flickr search module requires an api_key and a search string (q) or tags to be defined as an option")}var j=g.api_key;var f=g.q;var e=g.tags;var i={id:-1};var h=function(l){var k="http://farm"+l.farm+".static.flickr.com/"+l.server+"/"+l.id+"_"+l.secret+".jpg";return k};this.url=function(){var k="http://api.flickr.com/services/rest/?method=flickr.photos.search";k+="&api_key="+j+"&format=json&content_type=1";if(e!==undefined){k+="&tags="+escape(e)}if(f!==undefined){k+="&text="+escape(f)}return{url:k,callbackParam:"jsoncallback"}};this.process=function(n){var k={};k.data=[];var m=n.photos.photo;var l;for(l=0;l<m.length&&m[l].id!==i.id;l++){m[l].url=h(m[l]);m[l].user_url="http://www.flickr.com/"+m[l].owner;m[l].photo_url="http://www.flickr.com/"+m[l].owner+"/"+m[l].id;k.data.push(m[l])}i=m[0];k.update=(k.data.length>0)?true:false;return k}};c.feeds=function(f){a.modules.Module.call(this,f);var e=f.tags||null;var g={id:-1};this.url=function(){var h="http://api.flickr.com/services/feeds/photos_public.gne?format=json";if(e!==null){h+="&tags="+escape(e)}return{url:h,callbackParam:"jsoncallback"}};this.process=function(l){var h={};h.data=[];var k=l.items;var j;for(j=0;j<k.length&&k[j].link!==g.link;j++){k[j].url=k[j].media.m.replace("_m","");k[j].user_url="http://www.flickr.com/"+k[j].author_id;k[j].photo_url=k[j].link;k[j].user_id=k[j].author.match(/\(([^\)]*)\)/)[1];h.data.push(k[j])}g=k[0];h.update=(h.data.length>0)?true:false;return h}}})(window,"flickr");(function(d,b){var a=d.spotterjs;if(!a||!a.verify){throw new Error("problem with spotter.js file!")}a.verify(["util","modules"]);var c=a.namespace(b);c.search=function(g){a.modules.Module.call(this,g);var f="";var e=g.q;var h=0;if(e===undefined||e===""){throw new Error("identica search module requires a search string (q) to be specified as an option")}this.url=function(){var i="http://identi.ca/api/search.json";i+=f!==""?f:"?q="+escape(e);return i};this.process=function(l){var j={};var k;j.data=[];f=l.refresh_url;if(l.results.length>0){j.update=true;for(k=0;k<l.results.length&&l.results[k].id>h;++k){j.data.unshift(l.results[k])}h=l.results[0].id}else{j.update=false}return j}};c.realtimesearch=function(f){a.modules.Module.call(this,f);var e=f.q;var i=0;var h=1000;var g=[0,0,h];if(e===undefined||e===""){throw new Error("identica search module requires searchString to be specified as an option")}this.url=function(){var j="http://identi.ca/api/statuses/public_timeline.json?count="+h;return j};this.process=function(l){var j={};var k;if(i>0){g.push(l[0].id-i);g.shift();h=Math.ceil((g[0]+g[1]+g[2])/3)+10}j.data=[];if(l.length>0){for(k=0;k<l.length&&l[k].id>i;++k){if(l[k].text.match(new RegExp(e,"i"))){j.data.unshift(l[k])}}i=l[0].id;j.update=j.data.length===0?false:true}else{j.update=false}return j}}})(window,"identica");(function(d,b){var a=d.spotterjs;if(!a||!a.verify){throw new Error("problem with spotter.js file!")}a.verify(["util","modules"]);var c=a.namespace(b);c.search=function(g){a.modules.Module.call(this,g);var f="";var e=g.q;if(e===undefined||e===""){throw new Error("twitpic search module requires a search string (q) to be specified as an option")}this.url=function(){var h="http://search.twitter.com/search.json";h+=f!==""?f:"?q="+escape(e)+"+twitpic";return h};this.process=function(m){var j={};var k;var l;var h;f=m.refresh_url||"";j.update=(m.results.length>0)?true:false;j.data=[];for(k=0;k<m.results.length;k++){l=/http\:\/\/twitpic.com\/(\w+)/.exec(m.results[k].text);if(l!==null&&!m.results[k].text.match(new RegExp("^RT"))){h=l[1];m.results[k].twitpic_url="http://twitpic.com/"+h;m.results[k].twitpic_full_url="http://twitpic.com/show/full/"+h;m.results[k].twitpic_thumb_url="http://twitpic.com/show/thumb/"+h;m.results[k].twitpic_mini_url="http://twitpic.com/show/mini/"+h;j.data.push(m.results[k])}}return j}}})(window,"twitpic");(function(d,b){var a=d.spotterjs;if(!a||!a.verify){throw new Error("problem with spotter.js file!")}a.verify(["util","modules"]);var c=a.namespace(b);c.search=function(g){a.modules.Module.call(this,g,{require:["q"],allow:["lang","exclude"]});this.baseURL("http://search.twitter.com/search.json");var f="";var e=(g.exclude!==undefined)?g.exclude.split(","):[];var j;var h="";var k="";this.url=function(){var m;var i="";var l=this.baseURL();if(f&&f!==""){l+=f}else{l+="?";for(m in g){if(g.hasOwnProperty(m)&&m!=="exclude"){l+=i+m+"="+escape(g[m]);i="&"}}}return l};this.process=function(m){var i={};f=m.refresh_url||"";if(h===""){i.data=m.results}else{i.data=[];var l=new RegExp(h);for(j in m.results){if(m.results[j].text.match(l)===null){i.data.push(m.results[j])}}}i.update=(i.data.length>0)?true:false;return i}};c.user=function(e){a.modules.Module.call(this,e,{require:["screen_name"],allow:["count"]});this.baseURL("http://api.twitter.com/1/statuses/user_timeline.json");var f;var g;this.url=function(){var j;var h="";var i=this.baseURL();i+="?";for(j in e){if(e.hasOwnProperty(j)){i+=h+j+"="+escape(e[j]);h="&"}}if(g){i+="&since_id="+g}return i};this.process=function(i){var h={};if(i.length>0){g=i[0].id_str}h.data=i;h.update=(h.data.length>0)?true:false;return h}};c.trends=function(e){a.modules.Module.call(this,e);var f;this.url=function(){var g="http://api.twitter.com/1/trends/1.json?";if(e!==undefined&&e.exclude!==undefined){g+="exclude="+e.exclude}return g};this.process=function(j){var g={};var i=j[0].trends;if(f===null){g={data:{added:i,removed:{},trends:i}}}else{var h=a.util.complements(i,f);g={data:{added:h[0],removed:h[1],trends:i}}}f=i;g.update=(g.data.added.length>0||g.data.removed.length>0)?true:false;return g}}})(window,"twitter");